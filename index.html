<style type="text/css">
    #attend_event {margin:0 auto;width:1600px;}
    #attend_event img {width:100%;}
    .attend_choice {cursor:pointer;margin-top:-20px;}
    .attend_point {position:relative;display:inline-block;}
    .attend_point ul {width:60%;margin:0 auto;
	position:absolute;top:0;
	left: 20%;
	transform: translate(-0%, -20%);	
	}

	.day1{ 
		position: absolute;
		top: 38px;
		width: 260px;
		left: 64px;
	}
	.day2{
		position: absolute;
		top: 38px;
		width: 260px;
		left: 357px;
	}
	 .day3{
		position: absolute;
		top: 38px;
		width: 260px;
		left: 643px;
	 }

	 
	 .attend_point ul li img{width:100%;}
	#coupon_download{
		position: fixed;
		top: 50%;
		left: 50%;
		transform: translate(-50%, -50%);
		 width: 500px; 
		  height: 200px; 
		  background-color:#17adc6; 
		  border: 8px solid #333;
		  border-radius: 10px; 
		  display: flex; 
		  justify-content: center; 
		  align-items: center; /
		  font-size: 30px;
		  font-weight: bold;
		  color: #333; 
		  text-align: center;
		cursor:pointer;
	}
	#coupon_wrapper{
	width:100%;height:100vh;
	background:#3333336e;position:fixed;
	top: 50%;
	left: 50%;
	transform: translate(-50%, -50%);
	display:none

	}
	#coupon_download ul li{width:100%;color:#fff;}
	#coupon_download ul li:nth-child(1){color:#fff;font-size:25px;font-weight:400;}
	#coupon_download ul li:nth-child(2){font-size:40px;font-weight:600;margin-top:10px;}
	#coupon_download ul li:nth-child(3){font-size:13px;font-weight:400;margin-top:10px;}

.coupon_closed {
    position: absolute;
    top: -39px;
    right: -28px;
    border: 4px solid #111;
    padding: 8px;
    padding-left: 18px;
    padding-right: 18px;
    border-radius: 100%;
    background: #fff;
    font-size: 29px;
    font-weight: 600;
    z-index: 9999;
}

.attend_choice2{margin-top:-20px;display:none}
.swal2-styled.swal2-confirm {
    border: 0;
    border-radius: 0.25em;
    background: initial;
    background-color: #16aec4;
    color: #fff;
    font-size: 1em;
}


</style>


<div id="attend_event">
    <div><img src="/web/img/event/attend/0227/web_01.jpg" alt=""/></div>
    <div class="attend_point">
        <img src="/web/img/event/attend/0227/web_02.jpg" alt=""/>
        <ul id="attendanceList">
            <!-- ì´ ë¶€ë¶„ì€ JavaScript ì½”ë“œì—ì„œ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤. -->
        </ul>
    </div>
    <div class="attend_choice" onclick="attendbar()"><img src="/web/img/event/attend/0227/web_03.jpg" alt=""/></div>
	<a href="https://yogibo.kr/exec/front/newcoupon/IssueDownload?coupon_no=6078322617400000403">
	<div class="attend_choice2"><img src="/web/img/event/attend/0227/web_03_03.jpg" alt=""></div>
	</a>
    <div><img src="/web/img/event/attend/0227/web_04.jpg" alt=""/></div>
	<div id="coupon_wrapper">		
		<div id="coupon_download">
			<div class="coupon_closed">X</div>
			<ul class="">
				<li>ì†ŒíŒŒ ì œí’ˆ êµ¬ë§¤ì‹œ</li>
				<li>10,000ì› ì¿ í° ë°œê¸‰ ë°›ê¸°</li>
				<li>â€»ì§€ê¸‰ëœ ì¿ í°ì˜ ìœ íš¨ ê¸°ê°„ì€ ë°œê¸‰ì¼ë¡œë¶€í„° 1ì¼ ì…ë‹ˆë‹¤.</li>
			</ul>
		</div>
	</div>
</div>


 <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script language="javascript" type="text/javascript">


    // ì¶œì„ì²´í¬ ìš”ì†Œë¥¼ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
    function showAttendanceElements(consecutiveAttendance) {
        const attendanceList = document.getElementById('attendanceList');

        // ê¸°ì¡´ ë„ì¥ ìš”ì†Œ ëª¨ë‘ ì œê±°
        attendanceList.innerHTML = '';

        // ìƒˆë¡œìš´ ë„ì¥ ìš”ì†Œ ì¶”ê°€
        for (let i = 1; i <= parseInt(consecutiveAttendance); i++) {
            const newAttendanceElement = document.createElement('li');
            newAttendanceElement.className = `day${i}`;
            newAttendanceElement.innerHTML = `<img src="/web/img/event/attend/0227/day${i}.png" alt=""/>`;
            attendanceList.appendChild(newAttendanceElement);
        }
    }

    function attendbar() {
        // ê³ ê° ì•„ì´ë””ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
        CAFE24API.getCustomerIDInfo(function(err, res) {
            if (err || !res || !res.id || !res.id.member_id) {
				alert("ë¡œê·¸ì¸ í›„ ì°¸ì—¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
				window.location.href = '/member/login.html'; // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
				return;
            }

            const memberId = res.id.member_id;

            // ì¶œì„ì²´í¬ ìš”ì²­
            axios.post('https://port-0-yogiback-am952nltee6yr6.sel5.cloudtype.app/attend', { memberId })
                .then(response => {
                    const newAttendanceCount = response.data.consecutiveAttendance;
                    const hasFailed = response.data.hasFailed;
                    showAttendanceElements(newAttendanceCount);

                    if (hasFailed) {
                        // ì¶œì„ì²´í¬ ì‹¤íŒ¨
                        alert('ì—°ì† ì¶œì„ì²´í¬ ì‹¤íŒ¨ ğŸ˜¢ ì‹¤ë§í•˜ì§€ ë§ˆì„¸ìš”, ì˜¤ëŠ˜ë¶€í„° ë‹¤ì‹œ ë„ì „í•  ìˆ˜ ìˆì–´ìš”!');
                        location.reload(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                    } else {
                        // ì¶œì„ì²´í¬ ì„±ê³µ
                        alert("ì¶œì„ ì™„ë£Œ!");
                    }

                    // 3íšŒì°¨ ì¶œì„ì²´í¬ ì™„ë£Œì‹œ ì¿ í° ë°œê¸‰
                    if (newAttendanceCount >= 3) {
                        document.getElementById('coupon_wrapper').style.display = 'block';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('ë‹¹ì¼ ì´ë²¤íŠ¸ ì°¸ì—¬ ì™„ë£Œ í•˜ì˜€ìŠµë‹ˆë‹¤.');
                });
        });
    }

    window.onload = function(event) {
        // ê³ ê° ì•„ì´ë””ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
        CAFE24API.getCustomerIDInfo(function(err, res) {
            if (!err && res && res.id && res.id.member_id) {
                const memberId = res.id.member_id;


				document.getElementById('coupon_download').addEventListener('click', function() {
				// ì„œë²„ì— ì¶œì„ì²´í¬ ì™„ë£Œ ì‹ í˜¸ë¥¼ ë³´ëƒ…ë‹ˆë‹¤.
				axios.post('https://port-0-yogiback-am952nltee6yr6.sel5.cloudtype.app/update-attendance', { memberId: memberId })
					.then(response => {
						// ì„±ê³µì ìœ¼ë¡œ ì‹ í˜¸ë¥¼ ë³´ë‚¸ ê²½ìš°, ì¿ í°ì„ ë‹¤ìš´ë¡œë“œ ë°›ìŠµë‹ˆë‹¤.
						window.location.href = 'https://yogibo.kr/exec/front/newcoupon/IssueDownload?coupon_no=6078322617400000403';
					})
					.catch(error => {
						console.error('Error:', error);
						alert('ì¿ í°ì„ ë‹¤ìš´ë¡œë“œí•˜ëŠ” ë° ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
					});
				});

                // ì¶œì„ì²´í¬ ìƒíƒœë¥¼ ê°€ì ¸ì˜¤ëŠ” ìš”ì²­
                axios.get(`https://port-0-yogiback-am952nltee6yr6.sel5.cloudtype.app/attendance-status/${memberId}`)
				.then(response => {
						const consecutiveAttendance = parseInt(response.data.consecutiveAttendance);
						const hasFailed = response.data.hasFailed;
						console.log('ë©¤ë²„ì•„ì´ë””:', memberId); // ì½˜ì†”ì— ì¶œë ¥
						console.log('ì¶œì„ì²´í¬:', consecutiveAttendance); // ì½˜ì†”ì— ì¶œë ¥
						showAttendanceElements(consecutiveAttendance);

						// 3íšŒì°¨ ì¶œì„ì²´í¬ ì™„ë£Œì‹œ ì¿ í° ë°œê¸‰
						if (consecutiveAttendance >= 3) {
							 document.getElementById('coupon_wrapper').style.display = 'block';
						}

						// ì¶œì„ì²´í¬ë¥¼ í•œ ì ì´ ìˆê³ , ì—°ì† ì¶œì„ì²´í¬ ì‹¤íŒ¨ ì‹œ
						if (hasFailed) {
							alert('ì—°ì† ì¶œì„ì²´í¬ ì‹¤íŒ¨ ğŸ˜¢ ì‹¤ë§í•˜ì§€ ë§ˆì„¸ìš”, ì˜¤ëŠ˜ë¶€í„° ë‹¤ì‹œ ë„ì „í•  ìˆ˜ ìˆì–´ìš”!');
						}
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        //alert('');
                    });
            } else {
                //alert("ë¡œê·¸ì¸ í›„ ì°¸ì—¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
            }
        });
    };
</script>
<script language="javascript" type="text/javascript">
//3íšŒì°¨ ì¶œì„ ì™„ë£Œì‹œ 
document.querySelector('.coupon_closed').addEventListener('click', function() {
	document.querySelector('#coupon_wrapper').style.display = 'none';
	document.querySelector('.attend_choice').style.display = 'none';
	document.querySelector('.attend_choice2').style.display = 'block';
});
</script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
<script>
  // alert() í•¨ìˆ˜ ì˜¤ë²„ë¼ì´ë“œ
  window.alert = function(message) {
    Swal.fire({
      title: 'ì¶œì„ì²´í¬',
      text: message,
     // icon: 'info',
      confirmButtonText: 'í™•ì¸'
    });
  }
</script>


